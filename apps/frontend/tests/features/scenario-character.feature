Feature: シナリオ×キャラクター関係管理
  TRPGシナリオ作成アプリのユーザーとして
  シナリオ内でキャラクターを作成し、その関係性を管理したい
  シナリオごとに異なるキャラクター関係を扱えるようにするため

  Background:
    Given アプリケーションを開いている
    And テスト用のシナリオ "冒険の始まり" が存在する

  Scenario: シナリオ内でキャラクターを新規作成して追加する
    When シナリオ "冒険の始まり" の詳細ページを開く
    And "登場キャラクター" セクションを表示する
    And プロンプトで "勇者" [説明: "世界を救う勇者", 役割: "主人公" ] を入力準備する
    And "キャラクターを作成" ボタンをクリックする
    Then 登場キャラクター一覧に "勇者" (役割: "主人公") が表示される

  Scenario: シナリオ内でキャラクターの役割を更新する
    Given シナリオ "冒険の始まり" にキャラクター "姫" (役割: "依頼人") が登録されている
    When シナリオ "冒険の始まり" の詳細ページを開く
    And プロンプトで役割 "協力者" を入力準備する
    And 登場キャラクター "姫" の編集ボタンをクリックする
    Then 登場キャラクター一覧に "姫" (役割: "協力者") が表示される

  Scenario: シナリオ内キャラクター関係性を作成する
    Given シナリオ "冒険の始まり" にキャラクター "勇者" (役割: "主人公") が登録されている
    And シナリオ "冒険の始まり" にキャラクター "姫" (役割: "協力者") が登録されている
    When シナリオ "冒険の始まり" の詳細ページを開く
    And "キャラクター関係性" セクションを表示する
    And "関係性を追加" ボタンをクリックする
    And 関係元キャラクターで "勇者" を選択する
    And 関係先キャラクターで "姫" を選択する
    And 関係名に "守る" と入力する
    And モーダルの "追加" ボタンをクリックする
    Then シナリオ "冒険の始まり" の関係性に "勇者" から "姫" への "守る" が表示される
  Scenario: シナリオからキャラクターを削除する
    Given シナリオ "冒険の始まり" にキャラクター "魔王" (役割: "敵") が登録されている
    When シナリオ "冒険の始まり" の詳細ページを開く
    And 削除確認ダイアログで "OK" を選択する準備をする
    And 登場キャラクター "魔王" の削除ボタンをクリックする
    Then 登場キャラクター一覧に "魔王" が表示されない