
Feature: シナリオキャラクター画像管理
  TRPGシナリオ作成アプリのユーザーとして
  シナリオ配下のキャラクターに画像を追加・管理したい
  シナリオ内キャラクターの視覚的な表現を豊かにするため

  Background:
    Given アプリケーションを開いている
    And テスト用のシナリオ "魔王討伐の旅" が存在する
    And シナリオ "魔王討伐の旅" にキャラクター "勇者" (役割: "主人公") が登録されている
    When シナリオ "魔王討伐の旅" の詳細ページを開く
    And シナリオ編集ページの "キャラクター" のタブをクリックする
    And 登場キャラクター "勇者" の編集ボタンをクリックする
    Then キャラクター編集モーダルが表示される
  @ignore
  Scenario: シナリオキャラクターに最初の画像を追加する
    When "画像を追加" ボタンをクリックする
    Then 画像アップロードモーダルが表示される
    When テスト画像をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像ギャラリーに画像が1枚表示される
    And その画像がメイン画像として表示される
  @ignore
  Scenario: シナリオキャラクターに複数の画像を追加する
    # 1枚目の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image1" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像ギャラリーに画像が1枚表示される

    # 2枚目の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image2" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像ギャラリーに画像が2枚表示される

    # 3枚目の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image3" をアップロードする
    And モーダルの "追加" ボタンをクリックする
  @ignore
  Scenario: シナリオキャラクターのメイン画像を変更する
    # 複数の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image1" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    And "画像を追加" ボタンをクリックする
    And テスト画像 "image2" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像 "image1" がメイン画像として表示される

    # メイン画像を変更
    When 画像 "image2" にマウスをホバーする
    And "メインに設定" ボタンをクリックする
    Then 画像 "image2" がメイン画像として表示される
    And 画像 "image1" は通常の画像として表示される
  @ignore
  Scenario: シナリオキャラクターに追加時にメイン画像を指定する
    # 1枚目の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image1" をアップロードする
    And モーダルの "追加" ボタンをクリックする

    # 2枚目の画像をメイン画像として追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image2" をアップロードする
    And "この画像をメイン画像に設定" チェックボックスをチェックする
    And モーダルの "追加" ボタンをクリックする
    Then 画像 "image2" がメイン画像として表示される
    And 画像 "image1" は通常の画像として表示される
  @ignore
  Scenario: シナリオキャラクターの画像を削除する
    # 複数の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image1" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    And "画像を追加" ボタンをクリックする
    And テスト画像 "image2" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像ギャラリーに画像が2枚表示される

    # 2枚目の画像を削除
    When 画像 "image2" にマウスをホバーする
    And 画像ギャラリーの2枚目を削除する
    And 確認ダイアログで "OK" をクリックする
    Then 画像ギャラリーに画像が1枚表示される
    And 画像 "image2" は表示されない
  @ignore
  Scenario: シナリオキャラクターのメイン画像を削除すると次の画像がメインになる
    # 複数の画像を追加
    When "画像を追加" ボタンをクリックする
    And テスト画像 "image1" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    And "画像を追加" ボタンをクリックする
    And テスト画像 "image2" をアップロードする
    And モーダルの "追加" ボタンをクリックする
    Then 画像 "image1" がメイン画像として表示される

    # 1枚目のメイン画像を削除
    When 画像 "image1" にマウスをホバーする
    And 画像ギャラリーの1枚目を削除する
    And 確認ダイアログで "OK" をクリックする
    Then 画像ギャラリーに画像が1枚表示される
    And 画像 "image2" がメイン画像として表示される
  @ignore
  Scenario: シナリオキャラクターに画像がない状態を確認する
    Then "画像が登録されていません" というメッセージが表示される
    And ページに "最初の画像を追加" が表示される
  @ignore
  Scenario: シナリオキャラクターの画像アップロードをキャンセルする
    When "画像を追加" ボタンをクリックする
    Then 画像アップロードモーダルが表示される
    When テスト画像をアップロードする
    And モーダルの "キャンセル" ボタンをクリックする
    Then 画像アップロードモーダルが閉じる
    And 画像ギャラリーに画像が追加されていない
